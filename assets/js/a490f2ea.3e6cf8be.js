"use strict";(self.webpackChunkmu_website=self.webpackChunkmu_website||[]).push([[4225],{49688:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>d,contentTitle:()=>s,default:()=>a,frontMatter:()=>c,metadata:()=>t,toc:()=>l});var i=e(74848),o=e(28453);const c={},s="BOT\u7ba1\u7406\u5458",t={id:"Blog/QQBot/BOT\u7ba1\u7406\u5458",title:"BOT\u7ba1\u7406\u5458",description:"2024/6/14",source:"@site/docs/Blog/05-QQBot/04-BOT\u7ba1\u7406\u5458.md",sourceDirName:"Blog/05-QQBot",slug:"/Blog/QQBot/BOT\u7ba1\u7406\u5458",permalink:"/docs/Blog/QQBot/BOT\u7ba1\u7406\u5458",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Blog/05-QQBot/04-BOT\u7ba1\u7406\u5458.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{},sidebar:"Blog",previous:{title:"github\u76d1\u63a7",permalink:"/docs/Blog/QQBot/github\u76d1\u63a7"},next:{title:"\u8bcd\u4e91\u7edf\u8ba1",permalink:"/docs/Blog/QQBot/\u8bcd\u4e91\u7edf\u8ba1"}},d={},l=[{value:"\u529f\u80fd\u8bbe\u8ba1",id:"\u529f\u80fd\u8bbe\u8ba1",level:2},{value:"init_admin.py",id:"init_adminpy",level:2},{value:"admin.py",id:"adminpy",level:2}];function u(n){const r={code:"code",h1:"h1",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h1,{id:"bot\u7ba1\u7406\u5458",children:"BOT\u7ba1\u7406\u5458"}),"\n",(0,i.jsx)(r.p,{children:"2024/6/14"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"\u529f\u80fd\u8bbe\u8ba1",children:"\u529f\u80fd\u8bbe\u8ba1"}),"\n",(0,i.jsx)(r.p,{children:"\u6846\u67b6\u5f88\u7b80\u5355"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-txt",children:"|--main.py\r\n|--admin.py\r\n|--admin.db\r\n|--init_admin.py\n"})}),"\n",(0,i.jsx)(r.p,{children:"init_admin.py\u751f\u6210db\u6570\u636e\u5e93\uff0c\u4f7f\u7528admin.py\u8bfb\u53d6\u6570\u636e\u5e93\u5e76\u8fdb\u884c\u6dfb\u52a0\u5220\u9664\u64cd\u4f5c\uff0c\u540c\u65f6\u8bfb\u53d6\u7528\u6237\u6743\u9650\u5224\u65ad\u7ba1\u7406\u5458\u80fd\u4f7f\u7528\u7684\u6743\u9650"}),"\n",(0,i.jsx)(r.p,{children:"\u8fd9\u91cc\u5c31\u4e0d\u518d\u8be6\u7ec6\u653e\u51fa\u548c\u89e3\u91ca\u4ee3\u7801"}),"\n",(0,i.jsx)(r.h2,{id:"init_adminpy",children:"init_admin.py"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import sqlite3\r\n\r\nconn = sqlite3.connect('admin.db')\r\ncursor = conn.cursor()\r\n\r\ncursor.execute('''\r\nCREATE TABLE IF NOT EXISTS admin (\r\n    user_id TEXT PRIMARY KEY,\r\n    permissions TEXT\r\n)\r\n''')\r\n\r\nconn.commit()\r\nconn.close()\n"})}),"\n",(0,i.jsx)(r.p,{children:"QQ\u53f7\u548c\u6743\u9650"}),"\n",(0,i.jsx)(r.h2,{id:"adminpy",children:"admin.py"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"def is_admin(qq_id):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n    cursor.execute('SELECT permissions FROM admin WHERE user_id = ?', (qq_id,))\r\n    result = cursor.fetchone()\r\n    conn.close()\r\n    return result\r\n\r\n\r\ndef add_admin(qq_id, permissions):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n    cursor.execute('INSERT OR IGNORE INTO admin (user_id, permissions) VALUES (?, ?)', (qq_id, permissions))\r\n    conn.commit()\r\n    conn.close()\r\n\r\n\r\ndef remove_admin(qq_id):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n    cursor.execute('DELETE FROM admin WHERE user_id = ?', (qq_id,))\r\n    conn.commit()\r\n    conn.close()\r\n    \r\n    \r\ndef query_uids_by_group(group_id):\r\n    conn = sqlite3.connect(os.path.join(os.path.dirname(__file__), 'scripts', 'bilibili', 'bilibili.db'))\r\n    cursor = conn.cursor()\r\n    cursor.execute('SELECT group_id, qq_id, bilibili_uid FROM monitoring WHERE group_id = ?', (group_id,))\r\n    rows = cursor.fetchall()\r\n    conn.close()\r\n    return rows\r\n\r\ndef remove_uid_by_group(bilibili_uid, group_id):\r\n    conn = sqlite3.connect(os.path.join(os.path.dirname(__file__), 'scripts', 'bilibili', 'bilibili.db'))\r\n    cursor = conn.cursor()\r\n    cursor.execute('DELETE FROM monitoring WHERE bilibili_uid = ? AND group_id = ?', (bilibili_uid, group_id))\r\n    conn.commit()\r\n    conn.close()\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u81f3\u4e8e\u600e\u4e48\u6dfb\u52a0\u7ba1\u7406\u5458\uff0c\u662f\u5426\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u548c\u666e\u901a\u7ba1\u7406\u5458\uff0c\u4e00\u5207\u5c31\u770b\u81ea\u5df1\u4e86"})]})}function a(n={}){const{wrapper:r}={...(0,o.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(u,{...n})}):u(n)}},28453:(n,r,e)=>{e.d(r,{R:()=>s,x:()=>t});var i=e(96540);const o={},c=i.createContext(o);function s(n){const r=i.useContext(c);return i.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function t(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),i.createElement(c.Provider,{value:r},n.children)}}}]);