"use strict";(self.webpackChunkmu_website=self.webpackChunkmu_website||[]).push([[8079],{32396:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>_,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var t=r(74848),s=r(28453);const o={},i="\u5173\u952e\u8bcd\u63d0\u9192",c={id:"Blog/QQBot/\u5173\u952e\u8bcd\u63d0\u9192",title:"\u5173\u952e\u8bcd\u63d0\u9192",description:"2024-6-16",source:"@site/docs/Blog/05-QQBot/06-\u5173\u952e\u8bcd\u63d0\u9192.md",sourceDirName:"Blog/05-QQBot",slug:"/Blog/QQBot/\u5173\u952e\u8bcd\u63d0\u9192",permalink:"/docs/Blog/QQBot/\u5173\u952e\u8bcd\u63d0\u9192",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Blog/05-QQBot/06-\u5173\u952e\u8bcd\u63d0\u9192.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{},sidebar:"Blog",previous:{title:"\u8bcd\u4e91\u7edf\u8ba1",permalink:"/docs/Blog/QQBot/\u8bcd\u4e91\u7edf\u8ba1"},next:{title:"\u52a0\u7fa4\u9000\u7fa4\u76d1\u63a7",permalink:"/docs/Blog/QQBot/\u52a0\u7fa4\u9000\u7fa4\u76d1\u63a7"}},d={},p=[{value:"\u529f\u80fd\u8bbe\u8ba1",id:"\u529f\u80fd\u8bbe\u8ba1",level:2},{value:"tips.py",id:"tipspy",level:2},{value:"init_tips.py",id:"init_tipspy",level:2}];function a(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h1,{id:"\u5173\u952e\u8bcd\u63d0\u9192",children:"\u5173\u952e\u8bcd\u63d0\u9192"}),"\n",(0,t.jsx)(e.p,{children:"2024-6-16"}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.h2,{id:"\u529f\u80fd\u8bbe\u8ba1",children:"\u529f\u80fd\u8bbe\u8ba1"}),"\n",(0,t.jsxs)(e.p,{children:["1.\u63a5\u53d7\u5230\u7fa4\u804a\uff08\u6240\u6709\u7fa4\u804a\uff09\u7684\u6d88\u606f\uff0c\u5982\u679c\u5305\u542b\u76d1\u63a7\u7684\u5185\u5bb9\uff0c\u5219\u5c06\u53d1\u9001\u8be5\u6d88\u606f\u5185\u5bb9\u7684QQ\u53f7\u53caQQ\u6635\u79f0\u3001\u53d1\u9001\u7684\u6d88\u606f\u5185\u5bb9\u3001\u53d1\u9001\u6d88\u606f\u7684\u65f6\u95f4\uff08YYYY-MM-DD HH",":MM","\uff09\u901a\u8fc7\u79c1\u804a\u7684\u5f62\u5f0f\u53d1\u9001\u7ed9\u6dfb\u52a0\u4ebaQQ\u53f7"]}),"\n",(0,t.jsx)(e.p,{children:"2.\u6240\u6709\u7528\u6237\u5747\u53ef\u8fdb\u884c\u6dfb\u52a0\uff0c\u6307\u4ee4\u4e3a/tips add [\u76d1\u63a7\u7684\u5185\u5bb9] \u5176\u4ed6\u6307\u4ee4\u5206\u522b\u662f\uff1a/tips info\uff08\u67e5\u8be2\u5f53\u524d\u4e2a\u4eba\u76d1\u63a7\u5185\u5bb9\uff09 /tips del [\u76d1\u63a7\u7684\u5185\u5bb9]\uff08\u5220\u9664\u5f53\u524d\u4e2a\u4eba\u76d1\u63a7\u7684\u5185\u5bb9\uff09"}),"\n",(0,t.jsx)(e.p,{children:"\u6587\u4ef6\u5b58\u653e\u5728/scripts/tips/\u4e0b\uff0c\u5176\u4e2d\uff1a"}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"/tips.py--\x3e\u5904\u7406\u63d0\u793a"}),"\n",(0,t.jsx)(e.p,{children:"/init_tips.py--\x3e\u5efa\u7acbsqlite3\u6570\u636e\u5e93\u5b58\u50a8\u5185\u5bb9"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:"\u5176\u4e2dtips.py\u5305\u542b\u6dfb\u52a0\u5173\u952e\u8bcd\u3001\u67e5\u8be2\u5173\u952e\u8bcd\u3001\u5220\u9664\u5173\u952e\u8bcd\u3001\u76d1\u63a7\u6d88\u606f\u4e2d\u662f\u5426\u5305\u542b\u6307\u5b9a\u5185\u5bb9"}),"\n",(0,t.jsx)(e.h2,{id:"tipspy",children:"tips.py"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'import sqlite3\r\nimport os\r\nimport datetime\r\nimport logging\r\n\r\nDATABASE_PATH = os.path.join(os.path.dirname(__file__), \'tips.db\')\r\n\r\ndef connect_db():\r\n    return sqlite3.connect(DATABASE_PATH)\r\n\r\ndef add_tips(qq_id, content):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute(\'\'\'\r\n    INSERT INTO tips (qq_id, content)\r\n    VALUES (?, ?)\r\n    \'\'\', (qq_id, content))\r\n\r\n    conn.commit()\r\n    conn.close()\r\n\r\n#\u67e5\u8be2tip\u8bb0\u5f55\uff08\u4e2a\u4eba\uff09\r\ndef get_tips(qq_id):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute(\'\'\'\r\n    SELECT content FROM tips\r\n    WHERE qq_id = ?\r\n    \'\'\', (qq_id,))\r\n\r\n    rows = cursor.fetchall()\r\n    conn.close()\r\n\r\n    return [row[0] for row in rows]\r\n\r\ndef remove_tips(qq_id, content):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute(\'\'\'\r\n    DELETE FROM tips\r\n    WHERE qq_id = ? AND content = ?\r\n    \'\'\', (qq_id, content))\r\n\r\n    conn.commit()\r\n    conn.close()\r\n\r\n#\u68c0\u67e5\u6d88\u606f\u662f\u5426\u5305\u542b\u76d1\u63a7\u5185\u5bb9\r\ndef check_tips(message, group_id, qq_id, qq_nickname, send_private_message):\r\n    conn = connect_db()\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute(\'\'\'\r\n    SELECT qq_id, content FROM tips\r\n    \'\'\')\r\n\r\n    rows = cursor.fetchall()\r\n    conn.close()\r\n\r\n    for row in rows:\r\n        tip_qq_id, content = row\r\n        if content in message:\r\n            now = datetime.datetime.now().strftime(\'%Y-%m-%d %H:%M:%S\')\r\n            send_private_message(tip_qq_id, f"\u76d1\u6d4b\u5230\u5173\u952e\u8bcd {content}\\n{qq_id}\uff08{qq_nickname}\uff09\u5728{now}\\n\u4e8e\u7fa4\u804a{group_id}\u4e2d\u53d1\u9001\u6d88\u606f\uff1a\\n{message}")\r\n\r\ndef handle_tips_command(command, qq_id, group_id, send_group_message):\r\n    logging.info(f"Handling tips command: {command} from user {qq_id}")\r\n    parts = command.split()\r\n    if len(parts) < 2:\r\n        send_group_message(group_id, "\u547d\u4ee4\u683c\u5f0f\u9519\u8bef, \u4f7f\u7528 /help \u67e5\u770b\u5e2e\u52a9")\r\n        return\r\n\r\n    action = parts[1]\r\n\r\n    if action == "add" and len(parts) == 3:\r\n        content = parts[2]\r\n        add_tips(qq_id, content)\r\n        send_group_message(group_id, f"\u5df2\u6dfb\u52a0\u76d1\u63a7\u5185\u5bb9: {content}")\r\n        logging.info(f"Added tips content: {content} for user {qq_id}")\r\n    elif action == "info" and len(parts) == 2:\r\n        tips = get_tips(qq_id)\r\n        if tips:\r\n            send_group_message(group_id, "\u4f60\u5f53\u524d\u76d1\u63a7\u7684\u5185\u5bb9:\\n" + "\\n".join(tips))\r\n        else:\r\n            send_group_message(group_id, "\u4f60\u5f53\u524d\u6ca1\u6709\u76d1\u63a7\u7684\u5185\u5bb9")\r\n        logging.info(f"Retrieved tips info for user {qq_id}")\r\n    elif action == "del" and len(parts) == 3:\r\n        content = parts[2]\r\n        remove_tips(qq_id, content)\r\n        send_group_message(group_id, f"\u5df2\u5220\u9664\u76d1\u63a7\u5185\u5bb9: {content}")\r\n        logging.info(f"Deleted tips content: {content} for user {qq_id}")\r\n    else:\r\n        send_group_message(group_id, "\u547d\u4ee4\u683c\u5f0f\u9519\u8bef, \u4f7f\u7528 /help \u67e5\u770b\u5e2e\u52a9")\r\n        logging.info(f"Invalid tips command format from user {qq_id}")\n'})}),"\n",(0,t.jsx)(e.h2,{id:"init_tipspy",children:"init_tips.py"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"import sqlite3\r\nimport os\r\n\r\nDATABASE_PATH = os.path.join(os.path.dirname(__file__), 'tips.db')\r\n\r\ndef create_db():\r\n    conn = sqlite3.connect(DATABASE_PATH)\r\n    cursor = conn.cursor()\r\n\r\n    cursor.execute('''\r\n    CREATE TABLE IF NOT EXISTS tips (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        qq_id TEXT NOT NULL,\r\n        content TEXT NOT NULL\r\n    )\r\n    ''')\r\n\r\n    conn.commit()\r\n    conn.close()\r\n\r\nif __name__ == \"__main__\":\r\n    create_db()\n"})}),"\n",(0,t.jsx)(e.p,{children:"\u7136\u540e\u4fee\u6539receive_event\u51fd\u6570\u7684\u4ee3\u7801\uff1a"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"if data['post_type'] == 'message' and data['message_type'] == 'private':\r\n    \u2026\u2026\r\nelif data['post_type'] == 'message' and data['message_type'] == 'group':\r\n    \u2026\u2026\r\n    elif message.startswith('/tip'):\r\n        handle_tips_command(message, user_id, group_id, send_group_message)\r\n    else:\r\n        record_message(group_id, message)\r\n        check_tips(message, group_id, user_id, qq_nickname, send_private_message)\n"})})]})}function _(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(a,{...n})}):a(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>i,x:()=>c});var t=r(96540);const s={},o=t.createContext(s);function i(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);